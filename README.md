## Shmmywiki Auto-results

#### Introduction

Auto-results is a set of tools developed for the Shmmywiki platform. The desired functionality is to:
* Extract course exam dates from the schedule PDF file provided by the ECE School website
* Fetch shmmy forum posts where course exam results are announced by users
* Use keyword matching on each post's content to find the corresponding course
* Generate wiki code for results table with exam and announcement dates, difference in days between them and URL of announcement post as columns
* Post generated table to wiki using a pywikibot

#### Progress

The project is still experimental with many core features missing or poorly implemented, such as:
* A better keyword matching algorithm, switching from a greedy to a more clever approach (e.g. keyword trees).
* Different course groups may have same exam dates but usually have different results dates. In this case, consider them as separate courses and implement keyword matching for each group.
* More flexible project structure for easier transitions in case of change in schedule file format and layout, or addition/modification/removal of courses

#### Project structure

The project is organized as follows:
* root folder: All the scripts are stored here.
    * `utils.py`: Contains helper text functions used in keyword matching algorithm and the extraction of exam results dates from forum posts
    * `match_keywords.py`: Helper function that implements the keyword matching algorithm.
    * `search_with_keyword.py`: Demo script that uses the `match_keywords` to search for courses by keyword.
    * `print_keywords.py`: Prints keyword database in JSON format using pprint.
    * `print_courses.py`: Prints courses database in JSON format using pprint.
    * `update_course_list.py`: Migrates changes in course list file to courses database and keywords database.
    * `build_keywords.py`: Tool to browse keywords database or add/edit/remove keywords from a selected course.
    * `pdfparse.py`: Parses schedule PDF file and exports course exam dates to `outputs/dates.json`.
    * `fetch_results.py`: Fetches result dates and URLs from forum posts and exports them to `outputs/results.json`. Keeps the ID of last accessed post to calculate how many new entries there have been.
    * `export_wiki.py`: Combines `dates.json` and `results.json` data to generate wiki code for results table.
    * `bot.py`: Logs in to Shmmywiki as ShmmywikiBot user and posts the generated table to the given page.
    * `user-config.py`: User configuration file for the pywikibot module.
    * `batch.py`: All-in-one script that fetches results and posts to wiki if there are new announcements.
* `db/`: All the course and course keywords information is stored here.
    * `course_list.txt`: List of courses with data for title, semester, flow and wiki page title. The ID of each course is given by its corresponding line number in this file.
    * `courses.json`: JSON that maps course IDs to course data. It is generated by `update_course_list.py`.
    * `keywords.json`: JSON that maps each possible keyword to a list of courses that are matched by it. Do not edit directly, use `build_keywords.py` for any changes instead.
* `outputs/`: All the script outputs are stored here.
    * `dates.json`: JSON that maps course IDs to exam dates. It is generated by `pdfparse.py`.
    * `results.json`: JSON that maps course IDs to result dates and result URLs. It is generated by `fetch_results.py`.
    * `export_wiki.txt`: Wiki code for the results table. It is generated by `export_wiki.py`.
    * `last_result_id.txt`: The ID of the last announcement forum post is stored here, so that `fetch_results.py` can know whether new course results have been announced.
    * `pdf_texts.txt`: Debug file generated by `pdfparse.py` that contains all textboxes parsed from the PDF along with their coordinates and any possible course title matches.
    * `pdf_svg.html`: Debug SVG file that models how `pdfparse.py` views the schedule tables as a grid.
* `pdf/`: Schedule PDFs are stored here.

#### Usage

When starting a project for a new exam period:
1. Include target schedule PDF in the `pdf/` folder.
1. Change `SCHEDULE_FILE` parameter in `pdfparse.py` to the corresponding filename.
1. Run `pdfparse.py`.
1. Change `FORUM_URL` parameter in `fetch_results.py` to the corresponding URL of the forum thread where the result announcements will be posted.
1. Change `PAGENAME` parameter in `bot.py` to the corresponding wiki page where the results table will be posted.

Then you can schedule `batch.py` to run periodically and it will automatically fetch new posts and update the wiki page.